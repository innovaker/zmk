cmake_minimum_required(VERSION 3.13.1)

project(zmk)

zephyr_linker_sources(RODATA include/linker/zmk-events.ld)

zephyr_include_directories(include)

zephyr_library()
zephyr_library_sources_ifdef(CONFIG_ZMK_SLEEP src/power.c)
zephyr_library_sources(src/kscan.c)
zephyr_library_sources(src/matrix_transform.c)
zephyr_library_sources(src/hid.c)
zephyr_library_sources(src/sensors.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_DISPLAY src/display.c)
zephyr_library_sources(src/event_manager.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_EXT_POWER src/ext_power_generic.c)
zephyr_library_sources(src/events/position_state_changed.c)
zephyr_library_sources(src/events/keycode_state_changed.c)
zephyr_library_sources(src/events/modifiers_state_changed.c)
zephyr_library_sources(src/events/sensor_event.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_BLE src/events/ble_active_profile_changed.c)
zephyr_library_sources_ifdef(CONFIG_USB src/events/usb_conn_state_changed.c)
if (NOT CONFIG_ZMK_SPLIT_BLE_ROLE_PERIPHERAL)
  zephyr_library_sources(src/behaviors/behavior_key_press.c)
  zephyr_library_sources(src/behaviors/behavior_reset.c)
  zephyr_library_sources(src/behaviors/behavior_hold_tap.c)
  zephyr_library_sources(src/behaviors/behavior_sticky_key.c)
  zephyr_library_sources(src/behaviors/behavior_momentary_layer.c)
  zephyr_library_sources(src/behaviors/behavior_outputs.c)
  zephyr_library_sources(src/behaviors/behavior_toggle_layer.c)
  zephyr_library_sources(src/behaviors/behavior_transparent.c)
  zephyr_library_sources(src/behaviors/behavior_none.c)
  zephyr_library_sources(src/behaviors/behavior_sensor_rotate_key_press.c)
  zephyr_library_sources_ifdef(CONFIG_ZMK_EXT_POWER src/behaviors/behavior_ext_power.c)
  zephyr_library_sources(src/keymap.c)
endif()
zephyr_library_sources_ifdef(CONFIG_ZMK_RGB_UNDERGLOW src/behaviors/behavior_rgb_underglow.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_BLE src/behaviors/behavior_bt.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_BLE src/ble.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_BLE src/battery.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_SPLIT_BLE_ROLE_PERIPHERAL src/split_listener.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_SPLIT_BLE_ROLE_PERIPHERAL src/split/bluetooth/service.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_SPLIT_BLE_ROLE_CENTRAL src/split/bluetooth/central.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_KSCAN_MOCK_DRIVER src/kscan_mock.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_KSCAN_COMPOSITE_DRIVER src/kscan_composite.c)
zephyr_library_sources_ifdef(CONFIG_USB src/usb.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_BLE src/hog.c)
zephyr_library_sources_ifdef(CONFIG_ZMK_RGB_UNDERGLOW src/rgb_underglow.c)
zephyr_library_sources(src/endpoints.c)
zephyr_library_sources(src/hid_listener.c)
zephyr_library_sources_ifdef(CONFIG_SETTINGS src/settings.c)
zephyr_library_sources(src/main.c)

zephyr_cc_option(-Wfatal-errors)
